import React from "react";
import "@testing-library/jest-dom/extend-expect";
import { render, screen } from "@testing-library/react";
import userEvent from "@testing-library/user-event";
import { Filter } from "../components/Filter";
import { Countries } from "../components/Countries";

test("renders content", () => {
  const mockHandler = jest.fn();
  render(<Filter readFilter={"test"} handleOnChange={mockHandler} />);
  const element = screen.getByText("filter shown with");
  const elementNotPresent = screen.queryByText("languages");
  expect(element).toBeDefined();
  expect(elementNotPresent).toBeNull();
});

test("display country when I type Belgium", async () => {
  const mocks = jest.fn();
  const json = JSON.parse(
    '[{"name":{"common":"Belgium","official":"Kingdom of Belgium","nativeName":{"deu":{"official":"Königreich Belgien","common":"Belgien"},"fra":{"official":"Royaume de Belgique","common":"Belgique"},"nld":{"official":"Koninkrijk België","common":"België"}}},"tld":[".be"],"cca2":"BE","ccn3":"056","cca3":"BEL","cioc":"BEL","independent":true,"status":"officially-assigned","unMember":true,"currencies":{"EUR":{"name":"Euro","symbol":"€"}},"idd":{"root":"+3","suffixes":["2"]},"capital":["Brussels"],"altSpellings":["BE","België","Belgie","Belgien","Belgique","Kingdom of Belgium","Koninkrijk België","Royaume de Belgique","Königreich Belgien"],"region":"Europe","subregion":"Western Europe","languages":{"deu":"German","fra":"French","nld":"Dutch"},"translations":{"ara":{"official":"مملكة بلجيكا","common":"بلجيكا"},"bre":{"official":"Rouantelezh Belgia","common":"Belgia"},"ces":{"official":"Belgické království","common":"Belgie"},"cym":{"official":"Teyrnas Gwlad Belg","common":"Gwlad Belg"},"deu":{"official":"Königreich Belgien","common":"Belgien"},"est":{"official":"Belgia Kuningriik","common":"Belgia"},"fin":{"official":"Belgian kuningaskunta","common":"Belgia"},"fra":{"official":"Royaume de Belgique","common":"Belgique"},"hrv":{"official":"Kraljevina Belgija","common":"Belgija"},"hun":{"official":"Belga Királyság","common":"Belgium"},"ita":{"official":"Regno del Belgio","common":"Belgio"},"jpn":{"official":"ベルギー王国","common":"ベルギー"},"kor":{"official":"벨기에 왕국","common":"벨기에"},"nld":{"official":"Koninkrijk België","common":"België"},"per":{"official":"پادشاهی بلژیک","common":"بلژیک"},"pol":{"official":"Królestwo Belgii","common":"Belgia"},"por":{"official":"Reino da Bélgica","common":"Bélgica"},"rus":{"official":"Королевство Бельгия","common":"Бельгия"},"slk":{"official":"Belgické kráľovstvo","common":"Belgicko"},"spa":{"official":"Reino de Bélgica","common":"Bélgica"},"srp":{"official":"Краљевина Белгија","common":"Белгија"},"swe":{"official":"Konungariket Belgien","common":"Belgien"},"tur":{"official":"Belçika Krallığı","common":"Belğika"},"urd":{"official":"مملکتِ بلجئیم","common":"بلجئیم"},"zho":{"official":"比利时王国","common":"比利时"}},"latlng":[50.83333333,4.0],"landlocked":false,"borders":["FRA","DEU","LUX","NLD"],"area":30528.0,"demonyms":{"eng":{"f":"Belgian","m":"Belgian"},"fra":{"f":"Belge","m":"Belge"}},"flag":"\uD83C\uDDE7\uD83C\uDDEA","maps":{"googleMaps":"https://goo.gl/maps/UQQzat85TCtPRXAL8","openStreetMaps":"https://www.openstreetmap.org/relation/52411"},"population":11555997,"gini":{"2018":27.2},"fifa":"BEL","car":{"signs":["B"],"side":"right"},"timezones":["UTC+01:00"],"continents":["Europe"],"flags":{"png":"https://flagcdn.com/w320/be.png","svg":"https://flagcdn.com/be.svg","alt":"The flag of Belgium is composed of three equal vertical bands of black, yellow and red."},"coatOfArms":{"png":"https://mainfacts.com/media/images/coats_of_arms/be.png","svg":"https://mainfacts.com/media/images/coats_of_arms/be.svg"},"startOfWeek":"monday","capitalInfo":{"latlng":[50.83,4.33]}}]'
  );
  render(<Countries countries={json} handleOnClick={mocks} />);
  expect(screen.getByText("Belgium")).toBeDefined();
  expect(screen.getByText("capital Brussels")).toBeDefined();
  expect(screen.getByText("languages")).toBeDefined();
  expect(
    screen.getByAltText(
      "The flag of Belgium is composed of three equal vertical bands of black, yellow and red."
    )
  ).toBeDefined();
});

test("display country when I have more than one country", () => {
  const showMocks = jest.fn();
  const user = userEvent.setup();
  const json = JSON.parse(
    '[{"name":{"common":"Palau","official":"Republic of Palau","nativeName":{"eng":{"official":"Republic of Palau","common":"Palau"},"pau":{"official":"Beluu er a Belau","common":"Belau"}}},"tld":[".pw"],"cca2":"PW","ccn3":"585","cca3":"PLW","cioc":"PLW","independent":true,"status":"officially-assigned","unMember":true,"currencies":{"USD":{"name":"United States dollar","symbol":"$"}},"idd":{"root":"+6","suffixes":["80"]},"capital":["Ngerulmud"],"altSpellings":["PW","Republic of Palau","Beluu er a Belau"],"region":"Oceania","subregion":"Micronesia","languages":{"eng":"English","pau":"Palauan"},"translations":{"ara":{"official":"جمهورية بالاو","common":"بالاو"},"bre":{"official":"Republik Palau","common":"Palau"},"ces":{"official":"Republika Palau","common":"Palau"},"cym":{"official":"Republic of Palau","common":"Palau"},"deu":{"official":"Republik Palau","common":"Palau"},"est":{"official":"Belau Vabariik","common":"Belau"},"fin":{"official":"Palaun tasavalta","common":"Palau"},"fra":{"official":"République des Palaos (Palau)","common":"Palaos (Palau)"},"hrv":{"official":"Republika Palau","common":"Palau"},"hun":{"official":"Palaui Köztársaság","common":"Palau"},"ita":{"official":"Repubblica di Palau","common":"Palau"},"jpn":{"official":"パラオ共和国","common":"パラオ"},"kor":{"official":"팔라우 공화국","common":"팔라우"},"nld":{"official":"Republiek van Palau","common":"Palau"},"per":{"official":"جمهوری پالائو","common":"پالائو"},"pol":{"official":"Republika Palau","common":"Palau"},"por":{"official":"República de Palau","common":"Palau"},"rus":{"official":"Республика Палау","common":"Палау"},"slk":{"official":"Palauská republika","common":"Palau"},"spa":{"official":"República de Palau","common":"Palau"},"srp":{"official":"Република Палау","common":"Палау"},"swe":{"official":"Republiken Palau","common":"Palau"},"tur":{"official":"Palau Cumhuriyeti","common":"Palau"},"urd":{"official":"جمہوریہ پلاؤ","common":"پلاؤ"},"zho":{"official":"帕劳共和国","common":"帕劳"}},"latlng":[7.5,134.5],"landlocked":false,"area":459.0,"demonyms":{"eng":{"f":"Palauan","m":"Palauan"},"fra":{"f":"Paluane","m":"Paluan"}},"flag":"\uD83C\uDDF5\uD83C\uDDFC","maps":{"googleMaps":"https://goo.gl/maps/MVasQBbUkQP7qQDR9","openStreetMaps":"https://www.openstreetmap.org/relation/571805"},"population":18092,"car":{"signs":["PAL"],"side":"right"},"timezones":["UTC+09:00"],"continents":["Oceania"],"flags":{"png":"https://flagcdn.com/w320/pw.png","svg":"https://flagcdn.com/pw.svg","alt":"The flag of Palau has a light blue field with a large golden-yellow circle that is offset slightly towards the hoist side of center."},"coatOfArms":{"png":"https://mainfacts.com/media/images/coats_of_arms/pw.png","svg":"https://mainfacts.com/media/images/coats_of_arms/pw.svg"},"startOfWeek":"monday","capitalInfo":{"latlng":[7.5,134.62]},"postalCode":{"format":"96940","regex":"^(96940)$"}},{"name":{"common":"Belarus","official":"Republic of Belarus","nativeName":{"bel":{"official":"Рэспубліка Беларусь","common":"Белару́сь"},"rus":{"official":"Республика Беларусь","common":"Беларусь"}}},"tld":[".by"],"cca2":"BY","ccn3":"112","cca3":"BLR","cioc":"BLR","independent":true,"status":"officially-assigned","unMember":true,"currencies":{"BYN":{"name":"Belarusian ruble","symbol":"Br"}},"idd":{"root":"+3","suffixes":["75"]},"capital":["Minsk"],"altSpellings":["BY","Bielaruś","Republic of Belarus","Белоруссия","Республика Белоруссия"],"region":"Europe","subregion":"Eastern Europe","languages":{"bel":"Belarusian","rus":"Russian"},"translations":{"ara":{"official":"جمهورية بيلاروسيا","common":"بيلاروسيا"},"bre":{"official":"Republik Belarus","common":"Belarus"},"ces":{"official":"Běloruská republika","common":"Bělorusko"},"cym":{"official":"Gweriniaeth Belarws","common":"Belarws"},"deu":{"official":"Republik Belarus","common":"Weißrussland"},"est":{"official":"Valgevene Vabariik","common":"Valgevene"},"fin":{"official":"Valko-Venäjän tasavalta","common":"Valko-Venäjä"},"fra":{"official":"République de Biélorussie","common":"Biélorussie"},"hrv":{"official":"Republika Bjelorusija","common":"Bjelorusija"},"hun":{"official":"Fehérorosz Köztársaság","common":"Fehéroroszország"},"ita":{"official":"Repubblica di Belarus","common":"Bielorussia"},"jpn":{"official":"ベラルーシ共和国","common":"ベラルーシ"},"kor":{"official":"벨라루스 공화국","common":"벨라루스"},"nld":{"official":"Republiek Belarus","common":"Wit-Rusland"},"per":{"official":"جمهوری بلاروس","common":"بلاروس"},"pol":{"official":"Republika Białorusi","common":"Białoruś"},"por":{"official":"República da Bielorrússia","common":"Bielorússia"},"rus":{"official":"Республика Беларусь","common":"Беларусь"},"slk":{"official":"Bieloruská republika","common":"Bielorusko"},"spa":{"official":"República de Belarús","common":"Bielorrusia"},"srp":{"official":"Република Белорусија","common":"Белорусија"},"swe":{"official":"Republiken Vitryssland","common":"Belarus"},"tur":{"official":"Belarus Cumhuriyeti","common":"Belarus"},"urd":{"official":"جمہوریہ بیلاروس","common":"بیلاروس"},"zho":{"official":"白俄罗斯共和国","common":"白俄罗斯"}},"latlng":[53.0,28.0],"landlocked":true,"borders":["LVA","LTU","POL","RUS","UKR"],"area":207600.0,"demonyms":{"eng":{"f":"Belarusian","m":"Belarusian"},"fra":{"f":"Biélorusse","m":"Biélorusse"}},"flag":"\uD83C\uDDE7\uD83C\uDDFE","maps":{"googleMaps":"https://goo.gl/maps/PJUDU3EBPSszCQcu6","openStreetMaps":"https://www.openstreetmap.org/relation/59065"},"population":9398861,"gini":{"2019":25.3},"fifa":"BLR","car":{"signs":["BY"],"side":"right"},"timezones":["UTC+03:00"],"continents":["Europe"],"flags":{"png":"https://flagcdn.com/w320/by.png","svg":"https://flagcdn.com/by.svg","alt":"The flag of Belarus features a vertical band, with a white and red ornamental pattern, spanning about one-fifth the width of the field on the hoist side. Adjoining the vertical band are two horizontal bands of red and green, with the red band twice the height of the green band."},"coatOfArms":{"png":"https://mainfacts.com/media/images/coats_of_arms/by.png","svg":"https://mainfacts.com/media/images/coats_of_arms/by.svg"},"startOfWeek":"monday","capitalInfo":{"latlng":[53.9,27.57]}}]'
  );
  render(<Countries countries={json} handleOnClick={showMocks} />);
  const showsButton = screen.getAllByText("show");
  user.click(showsButton[0]);
//   expect(showMocks.mock.calls).toHaveLength(1);
  expect(screen.getByText("Palau")).toBeDefined();
  expect(screen.getByText("Belarus")).toBeDefined();
});
